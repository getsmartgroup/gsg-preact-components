import * as evosus from 'evosus-swaggerhub-sdk/es6/axios';
import { h } from 'preact';
import { useEffect, useState } from 'preact/hooks';
import { Box, Heading, Flex, Radio, RadioGroup, SimpleGrid, Accordion, AccordionItem, AccordionButton, AccordionPanel, AccordionIcon, Button, CheckboxGroup, Checkbox, VStack, Alert, AlertIcon, AlertTitle, AlertDescription } from '@chakra-ui/react';
const validateProps = ({ ticket, companySN, gsgToken, clientID }) => {
    if (!companySN || !ticket) {
        return Promise.reject('Invalid evosus access credentials');
    }
    if (!gsgToken || !clientID) {
        return Promise.reject('Invalid GSG access credentials');
    }
    return Promise.resolve({ ticket, companySN, gsgToken, clientID });
};
const fetchProductLines = async (inventory, { companySN, ticket }) => {
    const productLines = await inventory.inventoryProductLineSearch(companySN, ticket).then(res => res.data.response);
    if (!productLines) {
        return Promise.reject('Failed to retrieve product line items from Evosus API');
    }
    return Promise.resolve(productLines);
};
const EvosusDashboard = props => {
    const [productLines, setProductLines] = useState(null);
    const [errorMessage, setErrorMessage] = useState(null);
    const [productLine, setProductLine] = useState(null);
    const [syncFields, setSyncFields] = useState(['price', 'quantity', 'name', 'weight']);
    const [syncing, setSyncing] = useState(false);
    const [_syncResults, setSyncResults] = useState(null);
    // Init
    useEffect(() => {
        // Validate Props
        validateProps(props)
            .then(({ ticket, companySN }) => 
        // Fetch Product Lines
        fetchProductLines(new evosus.InventoryApi(), { ticket, companySN })
            .then(setProductLines)
            .then(setErrorMessage.bind(null, null)))
            .catch(setErrorMessage);
    }, [props]);
    const syncProducts = () => {
        setSyncing(true);
        fetch(`https://us-central1-get-smart-functions.cloudfunctions.net/main/evosus/products/sync?client=${props.clientID}`, {
            method: 'POST',
            body: JSON.stringify({
                search: {
                    productLineID: productLine
                },
                fields: syncFields
            }),
            headers: {
                authorization: `Bearer ${props.gsgToken}`,
                'content-type': 'application/json'
            }
        })
            .then(async (res) => {
            if (res.status === 408) {
                setErrorMessage('The request timed out, you may try again to finish syncing');
                throw new Error(await res.text());
            }
            if (res.status !== 200) {
                setErrorMessage(null);
                return res.json();
            }
            return res.json();
        })
            .then(setSyncResults)
            .then(setErrorMessage.bind(null, null))
            .catch(setErrorMessage.bind(null, 'Error while syncing'))
            .finally(setSyncing.bind(null, false));
    };
    return (<Box>
			<Heading w='100%' textAlign='right'>
				GSG Evosus Dashboard
			</Heading>
			<Box>
				{errorMessage ? (<Alert status='error'>
						<AlertIcon />
						<AlertTitle mr={2}>{errorMessage}</AlertTitle>
						<AlertDescription></AlertDescription>
					</Alert>) : null}
			</Box>
			<Accordion allowMultiple>
				<AccordionItem>
					<AccordionButton w='100%'>
						<Flex w='100%' alignItems='center' justifyContent='space-between'>
							<Heading size='md'>Sync Products</Heading>
							<AccordionIcon />
						</Flex>
					</AccordionButton>
					<AccordionPanel pb={4}>
						<VStack w='100%' justifyContent='stretch' alignItems='stretch' alignContent='stretch' justifyItems='stretch'>
							<Heading size='sm'>Select a product Line</Heading>
							{productLines === null ? 'Loading Product Lines' : null}
							<RadioGroup onChange={setProductLine} value={productLine ?? ''}>
								<SimpleGrid columns={2}>
									{productLines?.map(({ ProductLine, ProductLineID }) => (<Radio value={ProductLineID?.toString()}>{ProductLine}</Radio>))}
								</SimpleGrid>
							</RadioGroup>
							<Heading size='sm'>Select which properties should be synced</Heading>
							<CheckboxGroup onChange={(s) => setSyncFields(s)} value={syncFields}>
								<SimpleGrid>
									<Checkbox value='name'>Product Name</Checkbox>
									<Checkbox value='price'>Price</Checkbox>
									<Checkbox value='quantity'>Quantity</Checkbox>
									<Checkbox value='weight'>Weight</Checkbox>
								</SimpleGrid>
							</CheckboxGroup>
							<Box>
								<Button onClick={syncProducts} w='100%' mt={8} disabled={syncing || !productLine || syncFields.length === 0}>
									Sync Products
								</Button>
							</Box>
							<Box>{syncing ? 'Syncing...' : null}</Box>
						</VStack>
					</AccordionPanel>
				</AccordionItem>
			</Accordion>
		</Box>);
};
export default EvosusDashboard;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanN4Iiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvRXZvc3VzRGFzaGJvYXJkL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxNQUFNLGlDQUFpQyxDQUFBO0FBRXpELE9BQU8sRUFBdUIsQ0FBQyxFQUFFLE1BQU0sUUFBUSxDQUFBO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQ2xELE9BQU8sRUFDTixHQUFHLEVBQ0gsT0FBTyxFQUNQLElBQUksRUFDSixLQUFLLEVBQ0wsVUFBVSxFQUNWLFVBQVUsRUFDVixTQUFTLEVBQ1QsYUFBYSxFQUNiLGVBQWUsRUFDZixjQUFjLEVBQ2QsYUFBYSxFQUNiLE1BQU0sRUFDTixhQUFhLEVBQ2IsUUFBUSxFQUNSLE1BQU0sRUFDTixLQUFLLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixnQkFBZ0IsRUFDaEIsTUFBTSxrQkFBa0IsQ0FBQTtBQVN6QixNQUFNLGFBQWEsR0FBRyxDQUFDLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFTLEVBQWtCLEVBQUU7SUFDMUYsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUMxQixPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsbUNBQW1DLENBQUMsQ0FBQTtLQUMxRDtJQUNELElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDM0IsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLGdDQUFnQyxDQUFDLENBQUE7S0FDdkQ7SUFDRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFBO0FBQ2xFLENBQUMsQ0FBQTtBQUVELE1BQU0saUJBQWlCLEdBQUcsS0FBSyxFQUM5QixTQUE4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